# Event Analytics API

–í–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –¥–ª—è –∑–±–æ—Ä—É –ø–æ–¥—ñ–π (events) —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –Ω–∞ –±–∞–∑—ñ FastAPI –∑ PostgreSQL —Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º –æ–±—Ä–æ–±–∫–æ—é.

## üöÄ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞**: –ü–æ–≤–Ω—ñ—Å—Ç—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –∑ AsyncIO —Ç–∞ SQLAlchemy 2.0
- **–®–≤–∏–¥–∫–∏–π –∑–±—ñ—Ä –ø–æ–¥—ñ–π**: –í–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ–π –∑ –º–∞—Å–æ–≤–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏
- **JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**: –ë–µ–∑–ø–µ—á–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑ Bearer —Ç–æ–∫–µ–Ω–∞–º–∏ —Ç–∞ role-based –¥–æ—Å—Ç—É–ø–æ–º
- **–ë–µ–∑–ø–µ–∫–∞**: –ó–∞—Ö–∏—â–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è, –∞—É–¥–∏—Ç –±–µ–∑–ø–µ–∫–∏, –∑–∞—Ö–∏—â–µ–Ω—ñ API endpoints
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö**: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Pydantic
- **–ß–∏—Å—Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞**: –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è–º –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ
- **–ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ API –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ Swagger UI
- **Production-ready**: –ü–æ–≤–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è –∑ Docker Compose, health checks
- **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è, Redis –∫–µ—à—É–≤–∞–Ω–Ω—è

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ api/v1/            # API –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
‚îú‚îÄ‚îÄ core/              # –û—Å–Ω–æ–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö —Ç–∞ –ë–î
‚îú‚îÄ‚îÄ services/          # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
‚îî‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç–∏
```

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç


### üê≥ Docker Compose

```bash
# –†–æ–∑—Ä–æ–±–∫–∞
make docker-dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
make docker-prod

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å
make docker-status

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
make docker-logs

# –ó—É–ø–∏–Ω–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏
make docker-down
```

### üìã –†—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

1. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è:**
   ```bash
   cp .env.example .env
   ```

2. **–ó–∞–ø—É—Å–∫ Docker:**
   ```bash
   docker compose up -d
   ```

3. **API –¥–æ—Å—Ç—É–ø–Ω–µ –∑–∞ –∞–¥—Ä–µ—Å–æ—é:**
   - üöÄ API: http://localhost:8000
   - üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: http://localhost:8000/docs  
   - üêò PostgreSQL: localhost:5433
   - üî¥ Redis: localhost:6379

### ‚ö° –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞

```bash
# 1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
python3 -m venv venv
source venv/bin/activate

# 2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r requirements.txt

# 3. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è
cp .env.example .env

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
alembic upgrade head

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
make run
```

## üìñ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è API

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π

```bash
curl -X POST "http://localhost:8000/api/v1/events" 
  -H "Content-Type: application/json" 
  -d '{
    "events": [
      {
        "event_id": "550e8400-e29b-41d4-a716-446655440000",
        "user_id": 123,
        "event_type": "user_login",
        "occurred_at": "2025-01-13T10:30:00",
        "properties": {
          "browser": "Chrome",
          "ip": "192.168.1.1"
        }
      }
    ]
  }'
```

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ–π

```bash
# –í—Å—ñ –ø–æ–¥—ñ—ó
curl "http://localhost:8000/api/v1/events"

# –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
curl "http://localhost:8000/api/v1/events?user_id=123"

# –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ —Ç–∏–ø—É –ø–æ–¥—ñ—ó
curl "http://localhost:8000/api/v1/events?event_type=user_login"

# –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è
curl "http://localhost:8000/api/v1/events?limit=10&offset=20"
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

### üîê –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∞ –±–µ–∑–ø–µ–∫–∞

–û—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è:

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö PostgreSQL (–û–ë–û–í'–Ø–ó–ö–û–í–Ü)
POSTGRES_USER=your_db_username
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=events
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# JWT Authentication (REQUIRED FOR SECURITY)
JWT_SECRET_KEY=generate-a-secure-random-key-at-least-32-characters-long
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É
DEBUG=false
LOG_LEVEL=INFO
RATE_LIMIT_PER_MINUTE=1000

# –ü–æ—Ä—Ç–∏ –¥–ª—è Docker
POSTGRES_EXTERNAL_PORT=5433
APP_EXTERNAL_PORT=8000
```

‚ö†Ô∏è **–ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º–º—ñ—Ç—å—Ç–µ .env —Ñ–∞–π–ª –≤ git!** –í—ñ–Ω —É–∂–µ –¥–æ–¥–∞–Ω–æ –≤ .gitignore.

### üîê JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è

API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î JWT —Ç–æ–∫–µ–Ω–∏ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É endpoints:

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
make create-admin

# –î–µ–º–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä —Å–ø–æ—á–∞—Ç–∫—É)
make jwt-demo

# –†—É—á–Ω–∏–π —Ç–µ—Å—Ç
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "your_password"}'
```

**–ó–∞—Ö–∏—â–µ–Ω—ñ endpoints:**
- `POST /api/v1/events` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–¥—ñ–π
- `GET /api/v1/events` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ–π  


## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
./deploy.sh test

# –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫
make test

# –ó –ø–æ–∫—Ä–∏—Ç—Ç—è–º –∫–æ–¥—É
make test-coverage

# Docker —Ç–µ—Å—Ç–∏
make docker-test

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª
pytest tests/test_events.py -v
```

## üîß –†–æ–∑—Ä–æ–±–∫–∞

### –ö–æ–º–∞–Ω–¥–∏ Makefile

```bash
make run              # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ –ª–æ–∫–∞–ª—å–Ω–æ
make test            # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
make test-coverage   # –¢–µ—Å—Ç–∏ –∑ –ø–æ–∫—Ä–∏—Ç—Ç—è–º
make lint            # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É
make format          # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É
make docker-dev      # Docker —Ä–æ–∑—Ä–æ–±–∫–∞
make docker-prod     # Docker –ø—Ä–æ–¥–∞–∫—à–Ω
make docker-shell    # –î–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make docker-db-shell # –î–æ—Å—Ç—É–ø –¥–æ –ë–î
```


### –Ø–∫—ñ—Å—Ç—å –∫–æ–¥—É

```bash
# –õ—ñ–Ω—Ç–∏–Ω–≥
make lint

# –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
make format

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—ñ–≤
make type-check
```

## üîí –ë–µ–∑–ø–µ–∫–∞

- **–ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è**: –í—Å—ñ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ –≤ `.env` —Ñ–∞–π–ª–∞—Ö
- **Docker security**: –Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ –º–µ—Ä–µ–∂—ñ —Ç–∞ –æ–±–º–µ–∂–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó
- **Health checks**: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–Ω—É —Å–µ—Ä–≤—ñ—Å—ñ–≤
- **Production ready**: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

- **Health Check**: `GET /health`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: `/docs` —Ç–∞ `/redoc`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏**: JSON —Ñ–æ—Ä–º–∞—Ç –∑ —Ä—ñ–≤–Ω—è–º–∏
- **–ú–µ—Ç—Ä–∏–∫–∏**: Redis –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ PostgreSQL –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
- **Service Discovery**: Docker health checks
